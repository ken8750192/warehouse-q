<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>庫存與圖片查詢</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      font-size: 18px;
      line-height: 1.6;
    }
    h1 { font-size: 2.5em; margin-bottom: 0.5em; }
    #search { margin-bottom: 1em; }
    #search input, #search button {
      font-size: 1.2em; padding: 0.3em;
    }
    #search button { margin-left: 0.5em; }
    #result { margin-top: 1em; font-size: 1.5em; line-height: 1.4; }
    strong { color: #2a7ae2; font-size: 1.5em; }
    #prodImg { display: block; max-width: 80%; margin-bottom: 1em; }
  </style>
</head>
<body>
  <h1>產品位置與圖片查找</h1>

  <div id="search">
    <input id="skuInput" type="text" placeholder="輸入產品編號，或掃碼後直接顯示" />
    <button id="searchBtn">查詢</button>
  </div>

  <div id="result">
    <!-- 產品圖片 -->
    <img id="prodImg" src="" alt="產品圖片" style="display:none;" />
    <!-- 查詢結果文字 -->
    <div id="textResult">請輸入產品編號或掃碼。</div>
  </div>

  <script>
    // ===== 改成你的 CSV 链接（必须包含 image_url 一栏） =====
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/你的表ID/pub?output=csv';
    // ======================================================

    const elResult    = document.getElementById('textResult');
    const imgElement  = document.getElementById('prodImg');
    const inputSku    = document.getElementById('skuInput');
    const btnSearch   = document.getElementById('searchBtn');

    async function querySku(sku) {
      elResult.textContent = '查詢中…';
      imgElement.style.display = 'none';
      try {
        const res  = await fetch(CSV_URL);
        const csv  = await res.text();
        const lines = csv.trim().split('\n');
        const header = lines.shift().split(',');
        const idxSku  = header.indexOf('sku');
        const idxProd = header.indexOf('product_name');
        const idxLoc  = header.indexOf('location');
        const idxImg  = header.indexOf('image_url');

        let record = null;
        for (const line of lines) {
          const cols = line.split(',');
          if (cols[idxSku] === sku) {
            record = {
              name: cols[idxProd],
              loc:  cols[idxLoc],
              img:  cols[idxImg]
            };
            break;
          }
        }

        if (record) {
          // 显示图片
          if (record.img) {
            imgElement.src = record.img;
            imgElement.style.display = 'block';
          }
          // 显示文字
          elResult.innerHTML = `
            <p>產品名稱：<strong>${record.name}</strong></p>
            <p>產品編號：<strong>${sku}</strong></p>
            <p>所在儲位：<strong>${record.loc}</strong></p>
          `;
        } else {
          elResult.textContent = `找不到產品 ${sku} 的庫存記錄`;
        }
      } catch (e) {
        console.error(e);
        elResult.textContent = '讀取庫存資料失敗';
      }
    }

    btnSearch.addEventListener('click', () => {
      const sku = inputSku.value.trim();
      if (sku) querySku(sku);
    });

    // 扫码后自动查询
    const params = new URLSearchParams(window.location.search);
    const skuParam = params.get('sku');
    if (skuParam) {
      inputSku.value = skuParam;
      querySku(skuParam);
    }
  </script>
</body>
</html>
